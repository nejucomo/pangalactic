<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>pangalactic</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">pangalactic</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="synopsis"><a class="header" href="#synopsis">Synopsis</a></h1>
<p>Pangalactic aspires to become a decentralized data network tailored towards using deterministic computation for revision control and build systems. The flagship application built on this network is <code>pg</code>, a decentralized revision control tool, similar to git, monotone, mercurial, fossil, and so forth.</p>
<p>Pangalactic is <em>very much</em> an incomplete work in progress. The existing functionality is spotty, as well as the documentation in this book.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="building-pangalactic"><a class="header" href="#building-pangalactic">Building Pangalactic</a></h1>
<p>Users interact with pangalactic through a set of <em>binaries</em>:</p>
<ul>
<li><code>pg</code> - The primary high-level revision control binary; users who only want typical revision control can just use this.</li>
<li><code>pg-revcon</code> - A lower-level utility for revision control, useful for scripting or automation.</li>
<li><code>pg-store</code> - A <em>Store</em> interface, for users who want to interact with the Store directly instead of doing revision control.</li>
<li><code>pg-derive</code> - A tool to derive deterministic computations within the Store.</li>
<li><code>pg-seed</code> - A tool for initializing the Store.</li>
</ul>
<p>Additionally, <a href="user/../index.html">this book</a> is developed alongside the code for the binaries.</p>
<p>These binaries are build from a rust workspace <sup class="footnote-reference" id="fr-1-1"><a href="#footnote-1">1</a></sup>.</p>
<h2 id="build-steps"><a class="header" href="#build-steps">Build Steps</a></h2>
<p>The primary build and installation approach is via <a href="https://nixos.org/learn/"><code>nix</code></a>. This handles the entire build and installation process, including building binaries, building WASM components, rendering this book, generating diagrams, and so forth. It can also be used to run the full quality assurance checks performed by the Continuous Integration system. If you prefer not to use <code>nix</code> and to build/test the components "by hand", head over to the developer section on <a href="user/../dev/without-nix.html">Development without <code>nix</code></a>.</p>
<ol>
<li>Install <a href="https://nixos.org/download/#download-nix"><code>nix</code></a> on your system.</li>
<li>Set <code>export NIX_EXPERIMENTAL=flakes</code> in your shell to support the newer <code>flake</code> feature of <code>nix</code>. <sup class="footnote-reference" id="fr-2-1"><a href="#footnote-2">2</a></sup></li>
<li>Retrieve the source code from <a href="https://github.com/nejucomo/pangalactic">the pangalactic project on Github</a>.</li>
<li>In the source code directory run <code>nix build</code>.</li>
<li>This creates a symlink called <code>result</code> containing the binaries, book, and other artifacts:</li>
</ol>
<ul>
<li><code>result/bin/</code> - A directory with the binaries.</li>
<li><code>result/doc/pangalactic/index.html</code> - The rendering of this book.</li>
</ul>
<hr>
<ol class="footnote-definition"><li id="footnote-1">
<p>There are many rust crates within this rust workspace which can enable rust developers to extend and build upon pangalactic. If you are interested in extending or building rust code atop pangalactic, head over to the <a href="user/../dev/lets-hack.html">Let's Hack!</a> chapter. <a href="#fr-1-1">↩</a></p>
</li>
<li id="footnote-2">
<p>The developers of pangalactic consider it a bug of <code>nix</code> that this is not enabled by default. <a href="#fr-2-1">↩</a></p>
</li>
</ol><div style="break-before: page; page-break-before: always;"></div><h1 id="vision"><a class="header" href="#vision">Vision</a></h1>
<p><strong>TODO:</strong> Sort out terminology, especially <code>tech-concept-words</code>.</p>
<p>Let me tell you a tale...</p>
<p>Alice invites Bob to begin collaborating on a project, "OSSM Sauce", so she sends Bob the <code>publisher-id</code> she uses as her main collaboration nexus for the project.</p>
<p>Bob <em>subscribes</em> to this <code>publisher-id</code> to download a copy of the source code, history, and built artifacts. He examines the <code>main</code> <code>story</code> Alice has arranged to get a feel for the development of the project. He likes the idea, and he's excited to be invited to collaborate since OSSM Sauce is not yet announced to the public and is privately shared between a small group of collaborators, even though they are all coordinating on this project and many others through the universal <code>pangalactic network</code>.</p>
<p>Bob wants to know OSSM Sauce is safe for people to use, especially himself, so he browses the current code, looking for vulnerabilities, or even worse, anything malicious. He notices some surprising functionality and reviews the <code>main</code> <code>story</code> again to understand how that functionality arose.</p>
<p>The <code>main</code> <code>story</code> shows months of incremental development, organized in a legible fashion, giving a feasible description for how this functionality could be developed from scratch. It reads a bit like a text book introducing the design of  a complex engineering system incrementally. It has some branching <code>substories</code> in its history, that serve a bit like parenthetical or optional chapters in the development, giving Bob the choice of digging down into specific areas of development, or to continue on with the primary sequence of events.</p>
<p>As Bob drills down into a particular <code>substory</code>, he sees a change that introduces a novel technique he had never learned about elsewhere. The diff from earlier revisions to this point seem to produce a breakthrough result, as if by magic or pure genius.</p>
<p>The change in question first introduces <code>functional specifications</code> for how this surprising feature should function, which is part of the standard <code>editorial policy</code> of this branch which constrains the changes in the <code>substory</code> so that they are guaranteed to pass the automated determinstic criteria of the <code>editorial policy</code>. Then after defining these specifications, the next change simply produces the working functionality all at once.</p>
<p>Skeptical that this is how Alice actually figured this functionality out, so he switches from viewing the <code>main story</code> or <code>substories</code> to analyzing the <code>transaction ledger</code> of the project. This shows an alleged chronological sequence of operations Alice performed to add changes to stories, describe bundles of changes as a coherent unit, rewrite or modify sequences of changes to replace them with new sequences, introduce/remove/rename/re-arrange stories with respect to each other, and so on. These operations are how Alice was able to rearrange the project's history into such a clear pedagogical <code>main story</code>. By reviewing this <code>ledger</code>, Bob is able to review previously existing stories which show earlier attempts at developing the feature and defining the <code>specifications</code>. Finally with this insight, Bob has a closer understanding of how Alice had her breakthrough, and he sends her a message about what he learned from those older superceded stories.</p>
<p>Since Bob feels pretty confident that this project is safe to use directly, Bob launches the built artifacts on his system. He decides to use the downloaded artifacts rather than rebuilding them, because pangalactic verifies the proofs of computational integrity underlying the build process for the project, so he has very high confidence that they were produced by a very precisely specified toolchain. He's also confident every change in the stories he reviewed matched the <code>editorial policy</code> for those parts of the story, which rely on the same computational proving and validation system.</p>
<p>The artifacts launch in a popular runtime developed and built within the pangalactic system which restrains artifacts from taking actions beyond the capabilities Bob explicitly grants to them. He passes some testing / exploration capabilities and gets familiar with how OSSM Sauce operates and learns how to manipulate his exploratory capabilities to his satisfaction, so then he starts giving it more and more important capabilities influencing his broader life.</p>
<p>As he gains familiarity with OSSM Sauce, he begins introducing his own functional specifications and stories for new functionality and sends Alice his own <code>publisher id</code>. Soon Alice and Bob decide to share OSSM Sauce to a wider group, although people outside that wider group cannot access any of OSSM Sauce's history, code, or artifacts without someone, somewhere inviting them. Bob begins collaborating with other acquiantances similar to how he collaborates with Alice, by sharing <code>publisher ids</code> to bootstrap pangalactic connections.</p>
<p>Because they subscribe to each other this way, they are able to see updates from each other, which include suggestions for how Alice should modify her stories based on those Bob has produced, or vice versa, as well as issue tracking, annotation, and discussion systems to facilitate improving OSSM Sauce through a distributed, decentralized, web of collaborators of unknown extent.</p>
<p>Finally, since pangalactic has become such a useful universal development collaboration system, the developers of pangalactic itself continue to improve it as humanity spreads to other stars, allowing pangalactic to truly live up to its name.</p>
<p><strong>Plot hole:</strong> How do people afford to keep improving pangalactic?</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="architecture"><a class="header" href="#architecture">Architecture</a></h1>
<p>The pangalactic system is composed of several "infrastructure" layers for data storage &amp; distribution, synchronization among collaborators, determistic computation. Atop this infrastructure is the flagship <code>pg</code> revision control app, although nothing prevents other applications from building on this infrastructure.</p>
<h2 id="the-store"><a class="header" href="#the-store">The Store</a></h2>
<p>The <em>Store</em> is a universal immutable data storage and distribution layer, spread across a network. The key primitive is hash-based indexing, along with "directory" nodes for linking together data within the Store.</p>
<h3 id="the-local-store"><a class="header" href="#the-local-store">The Local Store</a></h3>
<p>The <em>Local Store</em> is a user-scoped filesystem storage backend containing a subset of the complete universal <em>Store</em>.</p>
<pre><code class="language-admonish info &quot;git comparison&quot;">Because the Local Store is user-scoped, *all* of a user's revision control storage is shared across all projects on the system. For example, if a user clones the same project into multiple different working directories, the revision control storage is deduplicated / cached for all working directories.

There is no equivalent of `.git` blob storage. This means if you need to ensure the complete history of a project is copied to a new host, you must either copy the entire Local Store (which may include other projects), or use the `pg` tool to perform the transfer.
</code></pre>
<h3 id="distribution"><a class="header" href="#distribution">Distribution</a></h3>
<p>The distribution of immutable data, which ensures that the data a user needs is accessible and allows them to retrieve it, is an unspecified feature area. The current code only supports a <em>Local Store</em>, and this means currently <em>projects cannot be shared across hosts</em>.</p>
<pre><code class="language-admonish danger &quot;Incomplete Prototype Hazard&quot;">This is an example of how `pangalactic` is in a prototype maturity phase and it is not wise to rely on it solely for revision control or storage needs yet.
</code></pre>
<pre><code class="language-TODO unfinished design:">Relationship and terminology between store, distribution, synchronization, and pub/sub crypto:

- Store: universal storage network
- Distribution: how users get the right data (and how to ensure it's available).
- Synchronization: how users share and learn about updates of projects they care about.
- pub/sub: how publisher ids and subscriptions are "storage/network agnostic".

Also, it's not clear yet if pub/sub is a separate layer above Store, or if Store _must_ be pub/sub aware.
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lets-hack-pangalactic"><a class="header" href="#lets-hack-pangalactic">Let's Hack Pangalactic!</a></h1>
<p>So you wanna hack on pangalactic, eh?</p>
<p>The first step is quick and easy, take the <em>Pangalactic Oath</em>:</p>
<blockquote>
<p>I dedicate some of my time toward improving pangalactic as I see fit in service of our glorious mission to explore all of the Milky Way.</p>
</blockquote>
<p>Don't fret about such an audacious Oath; we may fail, but it's worth a shot.</p>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<p>You'll benefit from some familiarity with the User Guide (such as <a href="dev/../user/building.html">Building</a>) and Design (especially the <a href="dev/../design/vision.html">Vision</a>).</p>
<p>With that in mind, check out the <a href="dev/./impl.html">Implementation</a> overview to get a feel for how it's currently implemented.</p>
<h2 id="the-journey-continues"><a class="header" href="#the-journey-continues">The Journey Continues</a></h2>
<p>... and if you've made it this far, best of luck. You've attained True Englightenment™️ <sup class="footnote-reference" id="fr-1-1"><a href="#footnote-1">1</a></sup>!</p>
<hr>
<ol class="footnote-definition"><li id="footnote-1">
<p>-at least in so far as these incomplete docs about a work-in-progress software project can help one attain True Englightenment™️. <a href="#fr-1-1">↩</a></p>
</li>
</ol><div style="break-before: page; page-break-before: always;"></div><h1 id="development-without-nix"><a class="header" href="#development-without-nix">Development Without <code>nix</code></a></h1>
<p>-a.k.a. the Tedious Way</p>
<h2 id="nix-training-wheels"><a class="header" href="#nix-training-wheels"><code>nix</code> Training Wheels</a></h2>
<p>If you want to run all of the build steps directly, but still benefit from <code>nix</code> to set up a complete development environment, you can run <code>nix develop</code>. This will drop you into a new shell process pre-configured with all the appropriate build tool releases to run everything directly without <code>nix</code> intermediating (beyond the environment setup).</p>
<h2 id="no-nix-at-all"><a class="header" href="#no-nix-at-all">No <code>nix</code> at All</a></h2>
<p>Finally if you want to build without <code>nix</code> present at all on your system, you will have to configure your development environment with all of the prerequisites.</p>
<p>In this case, the <code>flake.nix</code> and <code>nix-support/</code> files are the best documentation for how to install and configure the prerequisite development environment, because that is the literal code exercised by continuous integration. Start with <code>nix-support/init-system.nix</code> for the definition of build targets which are defined in <code>packages</code> or the development environment (in <code>devShells.default</code>).</p>
<p>In broad strokes the prerequisites for a non-nix system are:</p>
<ul>
<li>For the binaries:
<ul>
<li><code>rustup</code> (or the specific toolchain specified in <code>rust-toolchain.toml</code>)</li>
<li>The <code>cargo</code>, <code>clippy</code>, <code>rustc</code>, and <code>rustfmt</code> rust toolchain "components".</li>
<li>The <code>wasm32-unknown-unknown</code> rust toolchain "target" along with the target for your host. <sup class="footnote-reference" id="fr-1-1"><a href="#footnote-1">1</a></sup></li>
</ul>
</li>
<li>For the book:
<ul>
<li><code>mdbook</code>, <code>cargo-depgraph</code>, and <code>graphviz</code>.</li>
</ul>
</li>
</ul>
<h2 id="binaries-build-process"><a class="header" href="#binaries-build-process">Binaries Build Process</a></h2>
<p>... <strong>TODO</strong>: We want to simplify the non-nix and nix build process before writing this section.</p>
<hr>
<ol class="footnote-definition"><li id="footnote-1">
<p>None of this book covers cross-compiling specifically, but we note that a benefit of building with <code>nix</code> is much easier cross-compilation support. <a href="#fr-1-1">↩</a></p>
</li>
</ol><div style="break-before: page; page-break-before: always;"></div><h1 id="implementation"><a class="header" href="#implementation">Implementation</a></h1>
<p>There are separate commandline tools for accessing the different architectural layers of pangalactic (see <a href="dev/../design/arch.html">Architecture</a>).</p>
<p>Pangalactic is implemented primarily with <code>rust</code>, with <code>nix</code> orchestrating the build process. Deterministic computation relies on an assumption that <code>WASM</code> is deterministic <sup class="footnote-reference" id="fr-1-1"><a href="#footnote-1">1</a></sup>, and <code>wasmtime</code> is currently used as the execution environment. Both "host" code and "WASM guest" code is implemented in rust. Some crates are built both on the target host architecture and the WASM architecture to share data types across that boundary.</p>
<hr>
<ol class="footnote-definition"><li id="footnote-1">
<p>This needs careful investigation to ensure it is the case. The WASM specifications and issue trackers are not explicit about this goal. In any case, we hope to replace WASM with a system supporting concise non-interactive proofs of computational integrity. <a href="#fr-1-1">↩</a></p>
</li>
</ol><div style="break-before: page; page-break-before: always;"></div><h1 id="crate-intra-dependencies"><a class="header" href="#crate-intra-dependencies">Crate Intra-Dependencies</a></h1>
<p>Here are the current crate dependencies within this workspace, (with redundant transitive dependencies omitted):</p>
<p><img src="dev/../assets/generated/depgraph-ws-dedup.svg" alt="Intra-Workspace Dependencies" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
